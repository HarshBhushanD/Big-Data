{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-header text-center">
        <h3 class="mb-0">
          <i class="fas fa-heartbeat me-2"></i>Diabetes Risk Assessment
        </h3>
        <p class="mb-0 mt-2 opacity-75">Enter your clinical measurements for AI analysis</p>
      </div>
      <div class="card-body p-4">
        <form method="post" id="diabetesForm">
          <div class="row">
            <!-- Gender Field -->
            {% if 'Gender' in defaults %}
            <div class="col-md-6 mb-4">
              <label class="form-label">
                <i class="fas fa-venus-mars me-2"></i>Gender
              </label>
              <select class="form-control" name="Gender" required>
                <option value="Male" {% if defaults.Gender == 'Male' %}selected{% endif %}>Male</option>
                <option value="Female" {% if defaults.Gender == 'Female' %}selected{% endif %}>Female</option>
              </select>
            </div>
            {% endif %}
            
            {% for f in features %}
              <div class="col-md-6 mb-4">
                <label class="form-label">
                  <i class="fas fa-{% if 'Glucose' in f %}tint{% elif 'Blood' in f %}heartbeat{% elif 'BMI' in f %}weight{% elif 'Age' in f %}birthday-cake{% elif 'Pregnancies' in f %}baby{% else %}chart-line{% endif %} me-2"></i>
                  {{ f }}
                </label>
                {% if f == 'Pregnancies' and defaults.Gender == 'Male' %}
                  <input class="form-control" 
                         type="number" 
                         step="1" 
                         name="{{ f }}" 
                         value="0" 
                         readonly
                         style="background-color: #f8f9fa;">
                  <div class="form-text">Not applicable for males</div>
                {% else %}
                  <input class="form-control" 
                         type="number" 
                         step="{% if f in ['BloodPressure', 'Insulin', 'Glucose'] %}10{% else %}any{% endif %}" 
                         name="{{ f }}" 
                         value="{{ defaults[f] }}" 
                         required
                         {% if f in ['BloodPressure', 'Insulin', 'Glucose'] %}oninput="validateDivisibleBy10(this)"{% endif %}>
                  {% if f in ['BloodPressure', 'Insulin', 'Glucose'] %}
                    <div class="form-text">Must be divisible by 10</div>
                  {% endif %}
                {% endif %}
              </div>
            {% endfor %}
          </div>
          <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary btn-lg px-5">
              <i class="fas fa-chart-line me-2"></i>Analyze Risk
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
function validateDivisibleBy10(input) {
  const value = parseFloat(input.value);
  if (value % 10 !== 0) {
    input.setCustomValidity('Value must be divisible by 10');
    input.classList.add('is-invalid');
  } else {
    input.setCustomValidity('');
    input.classList.remove('is-invalid');
  }
}

// Handle gender change
document.querySelector('select[name="Gender"]').addEventListener('change', function() {
  const gender = this.value;
  const pregnanciesInput = document.querySelector('input[name="Pregnancies"]');
  
  if (gender === 'Male') {
    pregnanciesInput.value = '0';
    pregnanciesInput.readOnly = true;
    pregnanciesInput.style.backgroundColor = '#f8f9fa';
    pregnanciesInput.nextElementSibling.textContent = 'Not applicable for males';
  } else {
    pregnanciesInput.readOnly = false;
    pregnanciesInput.style.backgroundColor = '';
    pregnanciesInput.nextElementSibling.textContent = '';
    if (pregnanciesInput.value === '0') {
      pregnanciesInput.value = '1';
    }
  }
});

// Add validation on form submit
document.getElementById('diabetesForm').addEventListener('submit', function(e) {
  const inputs = document.querySelectorAll('input[oninput="validateDivisibleBy10(this)"]');
  let valid = true;
  
  inputs.forEach(input => {
    validateDivisibleBy10(input);
    if (input.classList.contains('is-invalid')) {
      valid = false;
    }
  });
  
  if (!valid) {
    e.preventDefault();
    alert('Please ensure Blood Pressure, Insulin, and Glucose values are divisible by 10');
  }
});
</script>
{% endblock %}